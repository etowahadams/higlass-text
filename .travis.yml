dist: trusty
language: node_js
node_js:
- '11'
branches:
  only:
  - master
  - "/^v.*$/"
addons:
  apt:
    packages:
      - xvfb
install:
    - npm install -g xvfb-maybe
before_script:
    - export CHROME_BIN=chromium-browser
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - npm install --quiet -g gulp
    - npm install
script:
    - npm run build
    - xvfb-maybe ./node_modules/karma/bin/karma start karma.conf.js --single-run
before_deploy:
    - npm run prerelease
deploy:
  - provider: releases
    skip_cleanup: true
    email: alexander_veit@hms.harvard.edu
    api_key:
      secure: WWymCyv8ixLYxmh4fv43Mglr3ufaerGHafDuBa4Br2OvifE6LJys/IcJkbe+lOMe6Z530P9j3sqpwPTZfDSrKdWOSZ7AoJRcv8BtNtJ/0W2E3A5zdEJDWlj/Kg2+nI1izfjTXqBY7eU+OnaqnvYLiCzhYcr9cLTUWNkUcSeAis4ejkUIGkv8R8dUn02kQTKv6FOvz7gD5c4yuZGX8tZO9Pf18Uqa+XRMo19V2kCxFElCj8/3RPKq70WuKOYEuZJSliUFAr6MydLeoHcUE40P9yfKPYhYjZMUXw1bEihqR58nDFR/XJndLWrjDmtW18ktCj8BVNjEaKxz6uitE3hf2Z52fRkt97rU7sXTt4x6K6KknxGJeFUr5yw+WsGBcaaBL/HdxSwewfW826Rrogu+q+5ONjOYFA7Y9T7ltPJDatgrE5zAt9A8H7HqLcBD1a4VONZLTm4h/ogEfRttXxFY9Fp8hqMRVRXdy+DhzDwDsAXJapJEYPrSG3JVllWg6sGLlsGCIPOB7MFp6zJ6RDB5ozO72pn8rb+sylMTUsOawwwwFHdudviRm3OtDIHjf3TNjL7XOcadGVARkp0TN8qUq08BQa3npAdO7CsKrxSrZzeqGJenYcaDrl5e2URKQwfh+wixscGRQ++ZzjYlu7sM4jJYDnsAfTqkVbaYLQPrjKY=
    file: dist.zip
    on:
      tags: true
      branch: master
      repo: higlass/higlass-text
  - provider: npm
    skip_cleanup: true
    email: alexander_veit@hms.harvard.edu
    api_key:
      secure: VRMWVFIaqEHbTtV3CP7AYHuWWgFFgjywEy4YkYBTtev+0DqrOpnHguLzZ7MePy2UYpktl+JoNh9W5NHh1Si7xey+UFKPb3H3xj11pjDqLPhxoW6ucE/kPAJAVBYCsViRPZ19gLEeLZeTx5gbcs8haYpv23ZlUq1ePjPpdU/IRXnCcFvO6BQnSNqPuy99+1H5ZpHCArrtX53Yq4On2U0pU6ldd5dtOAHgEZq+TnEmPRfRjcmIFD8O4lUv8+I1DIWhLErhjm3CM1kYcMR5lRkSyadyTtzZY+5R/gug/A7FqSJhukU0w00wkQHn5kbkoanfRBr7AhOfkSGQOjDdHS+gwcbmPyXt/u4OnHbzgqvtxf4GfuNCKUGrYLNm0WBC6KrvtxJQr6+GjMMFFBy/8lCV03Koj52m0GkComKH2DacW44XEYxsmJ5lUJ7J4yHT1oDoQi1hzuJ4ZJuhMC9RQ1OfmJh0wPhYYhuQPVOiI7D3Y9NFnCzJanHc9pZeUN7BJuMwUg2rm5RmI+jrxCzKwHwhBY6cl3ovWwfH9K1JudEVcVt/KTK6PLSZKgOqNSo4/RzAVmtKr4phl5nrIKKb7rhRlndFsjo+GHETrWeGocUm50eWB27u35OzkMDlEjs1rjBjCdiV9nCmysxCnqiZ5MG0XTKsIJ59Molk4NrugChn7Jk=
    on:
      tags: true
      branch: master
      repo: higlass/higlass-text
